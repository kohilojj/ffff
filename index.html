<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jassu & Jepu: TOTAL CONTROL</title>
    <style>
        body { margin: 0; background: #050505; color: #ff0000; font-family: 'Courier New', Courier, monospace; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* Hakkeriterminaali */
        #terminal { flex-grow: 1; padding: 20px; overflow-y: auto; font-size: 13px; line-height: 1.4; border-bottom: 2px solid #333; }
        .success { color: #00ff00; }
        .warning { color: yellow; }
        
        /* Valmentajat */
        #coach-box { height: 120px; background: #111; display: flex; align-items: center; padding: 10px; gap: 15px; border-top: 2px solid #ff0000; }
        .coach-img { width: 70px; height: 70px; border-radius: 50%; border: 2px solid red; }
        #coach-text { font-size: 14px; color: white; flex-grow: 1; font-style: italic; }

        /* Start-nappi */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        #start-btn { background: red; color: white; border: none; padding: 20px 40px; font-size: 20px; font-weight: bold; cursor: pointer; border-radius: 10px; }

        video { position: fixed; top: 10px; right: 10px; width: 100px; border: 1px solid red; display: none; }
    </style>
</head>
<body>

<div id="overlay">
    <button id="start-btn" onclick="initSimulation()">KÄYNNISTÄ JÄRJESTELMÄTESTI</button>
</div>

<div id="terminal">
    > ODOTETAAN KÄYTTÄJÄN LUPAA...<br>
</div>

<video id="v" autoplay playsinline></video>

<div id="coach-box">
    <img src="jepu.png" class="coach-img" id="c-img">
    <div id="coach-text">Jepu: "Oletko valmis näkemään, kuinka helposti selaimesi voi vuotaa tietoa?"</div>
</div>

<script>
    const term = document.getElementById('terminal');
    const cText = document.getElementById('coach-text');
    const cImg = document.getElementById('c-img');
    const synth = window.speechSynthesis;

    function log(txt, type) {
        const span = document.createElement('span');
        span.className = type || '';
        span.innerHTML = `> ${txt}<br>`;
        term.appendChild(span);
        term.scrollTop = term.scrollHeight;
    }

    function speak(text, who) {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'fi-FI';
        u.pitch = who === 'jassu' ? 1.2 : 0.8;
        cImg.src = who + ".png";
        cText.innerText = (who === 'jassu' ? 'Jassu: ' : 'Jepu: ') + text;
        synth.speak(u);
    }

    async function initSimulation() {
        document.getElementById('overlay').style.display = 'none';
        
        // --- VAIHE 1: SIJAINTI ---
        speak("Ensimmäisenä yritetään urkkia sun sijainti. Jos painat salli, tiedän missä asut.", "jepu");
        log("HAKU: GEOLOCATION API...", "warning");
        
        navigator.geolocation.getCurrentPosition(
            (pos) => { log(`SIJAINTI SAATU: ${pos.coords.latitude}, ${pos.coords.longitude}`, "success"); },
            () => { log("SIJAINTI ESTETTY. JÄRJESTELMÄ SUOJATTU.", "success"); }
        );

        // --- VAIHE 2: KAMERA & MIKKI ---
        setTimeout(async () => {
            speak("Nyt yritetään kaapata sun kasvot. Huomaa, miten selain kysyy lupaa!", "jassu");
            log("AKTIVOIDAAN MEDIASTREAM...", "warning");
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('v').srcObject = stream;
                document.getElementById('v').style.display = 'block';
                log("VIDEO/AUDIO-YHTEYS MUODOSTETTU.", "success");
            } catch (e) {
                log("MEDIA ESTETTY. KAMERA TURVASSA.", "success");
            }
        }, 8000);

        // --- VAIHE 3: ILMOITUKSET ---
        setTimeout(() => {
            speak("Yritän nyt saada oikeuden lähettää sulle roskapostia suoraan lukitusnäytölle.", "jepu");
            log("PYYDETÄÄN PUSH-OIKEUKSIA...", "warning");
            Notification.requestPermission().then(perm => {
                log(`ILMOITUKSET: ${perm.toUpperCase()}`, perm === 'granted' ? "warning" : "success");
            });
        }, 16000);

        // --- VAIHE 4: TÄRINÄ JA ÄÄNI ---
        setTimeout(() => {
            speak("NYT VAROITUS! Jos painoit 'Salli', voin tärisyttää sun puhelinta ja huutaa!", "jassu");
            log("CRITICAL ERROR: JÄRJESTELMÄ TÄRISEE...", "warning");
            if ("vibrate" in navigator) navigator.vibrate([100, 30, 100, 30, 500]);
            
            // Soitetaan hälytysääni
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            osc.type = 'square';
            osc.frequency.setValueAtTime(880, ctx.currentTime);
            osc.connect(ctx.destination);
            osc.start();
            setTimeout(() => osc.stop(), 2000);
        }, 22000);

        // --- VAIHE 5: LOPPUOPETUS ---
        setTimeout(() => {
            speak("Testi päättyy. Jos annoit luvat, olisin voinut seurata sua ja kuunnella sua. Älä koskaan paina Salli-nappia tuntemattomilla sivuilla. Sulje tää sivu nyt!", "jepu");
            log("DEMO VALMIS. KAIKKI YHTEYDET SULJETTU.", "success");
            log("OPETUS: SINÄ OLET PUHELIMESI PALOMUURI.", "success");
        }, 30000);
    }
</script>
</body>
</html>
